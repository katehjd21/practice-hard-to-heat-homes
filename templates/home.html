{% extends "base.html" %}
{% block content %}
<div class="govuk-grid-row">
  <div>
    <h1 class="govuk-heading-l">Hard to Heat Homes</h1>
    <table class="govuk-table govuk-table--small-text-until-tablet" id="data">
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th scope="col" class="govuk-table__header no-sort">Address</th>
          <th scope="col" class="govuk-table__header" title="Low 0-4 High">
            Hard To Heat Score:<br>(easy) 0 - 4 (hard)
          </th>
          <th scope="col" class="govuk-table__header no-sort">Map</th>
          <th scope="col" class="govuk-table__header no-sort"></th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        {% for prop in properties %}
        <tr class="govuk-table__row">
          <td scope="row" class="govuk-table__cell" id="{{prop.uprn}}">
            {% if prop.address == "" %}
              <a onclick="setAddress('{{prop.uprn}}','{{prop.uprn}}', '{{key}}')" style="color:blue; text-decoration: underline">Click for address</a>
            {% else %}
              {{ prop.address }}
            {% endif %}
          </td>
          <td scope="row" class="govuk-table__cell">{{ prop.score }}</td>
          <td>
            <div id="map-{{ prop.uprn }}" style="height: 150px; width: 200px;"></div>
          </td>
          <td scope="row" class="govuk-table__cell">
            <a class="govuk-button govuk-button--secondary" data-module="govuk-button"
               href="{{url_for('property', uprn=prop.uprn)}}"
               style="color:black; text-decoration: none">Details</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    {% block scripts %}
      <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
      <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap5.js"></script>

      <script defer>
        $(document).ready(function () {
          $("#data").DataTable({
            paging: true,
            pageLength: 25,
            order: [],
            ordering: true,
            columnDefs: [{
              orderable: false,
              targets: "no-sort"
            }]
          });
        });
      </script>

      <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="">
      </script>

      <script defer>
        document.addEventListener("DOMContentLoaded", function () {
          {% for prop in properties %}
            {% if prop.lat and prop.long %}
              const map{{prop.uprn}} = L.map('map-{{prop.uprn}}', {
                attributionControl: false,
                zoomControl: false
              }).setView([{{prop.lat}}, {{prop.long}}], 15);

              L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19
              }).addTo(map{{prop.uprn}});

              L.marker([{{prop.lat}}, {{prop.long}}]).addTo(map{{prop.uprn}});
            {% endif %}
          {% endfor %}
        });
      </script>
    {% endblock %}
  </div>
</div>
{% endblock %}




